@let chat = popup.openChat();

@if (chat) {
  <div class="popup">
    <div class="popup-header">
      <div class="header-avatar-wrap">
        <div class="header-avatar" [style.background]="chat.color">
          {{ getInitials(chat.name) }}
        </div>
        @if (otherOnline) {
          <span class="online-dot"></span>
        }
      </div>
      <span class="popup-name">{{ chat.name }}</span>
      <button class="close-btn" (click)="close()">✕</button>
    </div>

    <div class="message-list" #messageList>
      @for (msg of (messages$ | async) ?? []; track msg.id) {
        <div class="message" [class.mine]="msg.senderId === currentUid">
          <div class="bubble">{{ msg.text }}</div>
        </div>
      }
    </div>

    <div class="input-row">
      <textarea
        class="msg-input"
        placeholder="Message…"
        [(ngModel)]="text"
        (keydown)="onKeydown($event)"
        rows="1"
      ></textarea>
      <button class="send-btn" (click)="send()" [disabled]="!text.trim()">Send</button>
    </div>
  </div>
}
